---
# macOS firewall configuration (Application Firewall)

- name: Check macOS firewall status
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --getglobalstate
  register: macos_firewall_status
  changed_when: false
  become: true

- name: Enable macOS Application Firewall (if disabled)
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
  when: "'disabled' in macos_firewall_status.stdout.lower()"
  become: true
  changed_when: true

- name: Allow Tailscale through firewall
  ansible.builtin.command: /usr/libexec/ApplicationFirewall/socketfilterfw --add /Applications/Tailscale.app
  failed_when: false
  become: true
  changed_when: false
